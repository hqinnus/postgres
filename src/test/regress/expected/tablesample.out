--
-- TABLESAMPLE TEST
--
CREATE TABLE sample (id INT, name text);
INSERT INTO sample VALUES (1, 'victor');
INSERT INTO sample VALUES (2, 'peter');
INSERT INTO sample VALUES (3, 'james');
INSERT INTO sample VALUES (4, 'paul');
INSERT INTO sample VALUES (5, 'kate');
INSERT INTO sample VALUES (6, 'jane');
INSERT INTO sample VALUES (7, 'samual');
INSERT INTO sample VALUES (8, 'david');
INSERT INTO sample VALUES (9, 'job');
INSERT INTO sample VALUES (10, 'neil');
INSERT INTO sample VALUES (11, 'victor');
INSERT INTO sample VALUES (12, 'peter');
INSERT INTO sample VALUES (13, 'james');
INSERT INTO sample VALUES (14, 'paul');
INSERT INTO sample VALUES (15, 'kate');
INSERT INTO sample VALUES (16, 'jane');
INSERT INTO sample VALUES (17, 'samual');
INSERT INTO sample VALUES (18, 'david');
INSERT INTO sample VALUES (19, 'job');
INSERT INTO sample VALUES (20, 'neil');
CREATE TABLE course (id INT, course text);
INSERT INTO course VALUES (1, 'Physics');
INSERT INTO course VALUES (2, 'Computing');
INSERT INTO course VALUES (2, 'Math');
INSERT INTO course VALUES (3, 'Quantum Mechanics');
INSERT INTO course VALUES (5, 'Life Science');
INSERT INTO course VALUES (6, 'Food Science');
INSERT INTO course VALUES (1, 'Math');
INSERT INTO course VALUES (7, 'Music');
INSERT INTO course VALUES (3, 'Social Science');
INSERT INTO course VALUES (8, 'Material Science');
INSERT INTO course VALUES (9, 'Computing');
INSERT INTO course VALUES (10, 'Computing');
INSERT INTO course VALUES (12, 'Physics');
INSERT INTO course VALUES (13, 'Social Science');
INSERT INTO course VALUES (14, 'Physics');
INSERT INTO course VALUES (15, 'Music');
INSERT INTO course VALUES (16, 'Math');
INSERT INTO course VALUES (17, 'Chemistry');
INSERT INTO course VALUES (14, 'Math');
INSERT INTO course VALUES (18, 'Math');
INSERT INTO course VALUES (20, 'Computing');
ANALYZE sample;
ANALYZE course;
SELECT * FROM sample TABLESAMPLE SYSTEM (60) REPEATABLE (10);
 id |  name  
----+--------
  1 | victor
  2 | peter
  3 | james
  4 | paul
  5 | kate
  6 | jane
  7 | samual
  8 | david
  9 | job
 10 | neil
 11 | victor
 12 | peter
 13 | james
 14 | paul
 15 | kate
 16 | jane
 17 | samual
 18 | david
 19 | job
 20 | neil
(20 rows)

SELECT * FROM sample TABLESAMPLE BERNOULLI (70) REPEATABLE (11);
 id |  name  
----+--------
 18 | david
  2 | peter
  3 | james
 15 | kate
  5 | kate
  6 | jane
  7 | samual
 20 | neil
  9 | job
 10 | neil
 11 | victor
 12 | peter
 16 | jane
 17 | samual
(14 rows)

SELECT * FROM sample TABLESAMPLE BERNOULLI (70) REPEATABLE (11);
 id |  name  
----+--------
 18 | david
  2 | peter
  3 | james
 15 | kate
  5 | kate
  6 | jane
  7 | samual
 20 | neil
  9 | job
 10 | neil
 11 | victor
 12 | peter
 16 | jane
 17 | samual
(14 rows)

SELECT * FROM sample TABLESAMPLE BERNOULLI (70) REPEATABLE (19);
 id |  name  
----+--------
  1 | victor
 18 | david
  3 | james
 17 | samual
  5 | kate
  6 | jane
  7 | samual
  8 | david
 15 | kate
 19 | job
 11 | victor
 12 | peter
 13 | james
 14 | paul
(14 rows)

SELECT * FROM sample TABLESAMPLE BERNOULLI (7) REPEATABLE (19);
 id |  name  
----+--------
  7 | samual
(1 row)

SELECT * FROM sample TABLESAMPLE BERNOULLI (1) REPEATABLE (19);
 id | name 
----+------
(0 rows)

SELECT * FROM sample TABLESAMPLE SYSTEM (65) REPEATABLE (20);
 id |  name  
----+--------
  1 | victor
  2 | peter
  3 | james
  4 | paul
  5 | kate
  6 | jane
  7 | samual
  8 | david
  9 | job
 10 | neil
 11 | victor
 12 | peter
 13 | james
 14 | paul
 15 | kate
 16 | jane
 17 | samual
 18 | david
 19 | job
 20 | neil
(20 rows)

SELECT * FROM sample TABLESAMPLE SYSTEM (65) REPEATABLE (2);
 id | name 
----+------
(0 rows)

SELECT * FROM sample TABLESAMPLE SYSTEM (65) REPEATABLE (20);
 id |  name  
----+--------
  1 | victor
  2 | peter
  3 | james
  4 | paul
  5 | kate
  6 | jane
  7 | samual
  8 | david
  9 | job
 10 | neil
 11 | victor
 12 | peter
 13 | james
 14 | paul
 15 | kate
 16 | jane
 17 | samual
 18 | david
 19 | job
 20 | neil
(20 rows)

SELECT * FROM sample TABLESAMPLE BERNOULLI (70) REPEATABLE (11) order by id limit 5;
 id |  name  
----+--------
  2 | peter
  3 | james
  5 | kate
  6 | jane
  7 | samual
(5 rows)

SELECT * FROM 
	(SELECT * FROM sample TABLESAMPLE BERNOULLI (70) REPEATABLE (10)) s,
    course c
WHERE s.id = c.id;
 id |  name  | id |      course       
----+--------+----+-------------------
 16 | jane   | 16 | Math
 15 | kate   | 15 | Music
  3 | james  |  3 | Quantum Mechanics
  3 | james  |  3 | Social Science
  5 | kate   |  5 | Life Science
 18 | david  | 18 | Math
  7 | samual |  7 | Music
  8 | david  |  8 | Material Science
  9 | job    |  9 | Computing
 12 | peter  | 12 | Physics
 13 | james  | 13 | Social Science
 14 | paul   | 14 | Physics
 14 | paul   | 14 | Math
(13 rows)

SELECT * FROM 
	(SELECT * FROM sample TABLESAMPLE BERNOULLI (60) REPEATABLE (5)) s,
	(SELECT * FROM course TABLESAMPLE SYSTEM (50) REPEATABLE (11)) c
WHERE s.id = c.id;
 id |  name  | id |  course   
----+--------+----+-----------
  1 | victor |  1 | Physics
  1 | victor |  1 | Math
 17 | samual | 17 | Chemistry
 16 | jane   | 16 | Math
  9 | job    |  9 | Computing
 10 | neil   | 10 | Computing
 12 | peter  | 12 | Physics
(7 rows)

SELECT * INTO tmp FROM sample TABLESAMPLE BERNOULLI (4);
DROP TABLE tmp;
SELECT * INTO tmp FROM sample TABLESAMPLE SYSTEM (20);
DROP TABLE tmp;
SELECT * INTO tmp FROM
	(SELECT s.id, s.name, c.course FROM
			(SELECT * FROM sample TABLESAMPLE BERNOULLI (60)) s,
			(SELECT * FROM course TABLESAMPLE SYSTEM (50)) c
	 WHERE s.id = c.id) t;
DROP TABLE tmp;
DROP TABLE sample;
DROP TABLE course;
